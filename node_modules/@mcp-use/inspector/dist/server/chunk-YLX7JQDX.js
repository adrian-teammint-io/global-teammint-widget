import {
  checkClientFiles,
  getClientDistPath,
  getContentType
} from "./chunk-67ROKQZG.js";

// src/server/shared-static.ts
import { existsSync, readFileSync } from "fs";
import { join } from "path";
function registerStaticRoutes(app, clientDistPath) {
  const distPath = clientDistPath || getClientDistPath();
  if (!checkClientFiles(distPath)) {
    console.warn(`\u26A0\uFE0F  MCP Inspector client files not found at ${distPath}`);
    console.warn(
      `   Run 'yarn build' in the inspector package to build the UI`
    );
    app.get("*", (c) => {
      return c.html(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>MCP Inspector</title>
        </head>
        <body>
          <h1>MCP Inspector</h1>
          <p>Client files not found. Please run 'yarn build' to build the UI.</p>
        </body>
      </html>
    `);
    });
    return;
  }
  app.get("/inspector/assets/*", (c) => {
    const path = c.req.path.replace("/inspector/assets/", "assets/");
    const fullPath = join(distPath, path);
    if (existsSync(fullPath)) {
      const content = readFileSync(fullPath);
      const contentType = getContentType(fullPath);
      c.header("Content-Type", contentType);
      return c.body(content);
    }
    return c.notFound();
  });
  app.get("/", (c) => {
    return c.redirect("/inspector");
  });
  app.get("/inspector", (c) => {
    const indexPath = join(distPath, "index.html");
    if (existsSync(indexPath)) {
      const content = readFileSync(indexPath, "utf-8");
      return c.html(content);
    }
    return c.html(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>MCP Inspector</title>
        </head>
        <body>
          <h1>MCP Inspector</h1>
          <p>Client files not found. Please run 'yarn build' to build the UI.</p>
        </body>
      </html>
    `);
  });
  const handleInspectorRoute = (c) => {
    const indexPath = join(distPath, "index.html");
    if (existsSync(indexPath)) {
      const content = readFileSync(indexPath, "utf-8");
      return c.html(content);
    }
    return c.notFound();
  };
  app.get("/inspector/*", handleInspectorRoute);
  app.post("/inspector/*", handleInspectorRoute);
  app.get("*", (c) => {
    const indexPath = join(distPath, "index.html");
    if (existsSync(indexPath)) {
      const content = readFileSync(indexPath, "utf-8");
      return c.html(content);
    }
    return c.html(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>MCP Inspector</title>
        </head>
        <body>
          <h1>MCP Inspector</h1>
          <p>Client files not found. Please run 'yarn build' to build the UI.</p>
        </body>
      </html>
    `);
  });
}
function registerStaticRoutesWithDevProxy(app, clientDistPath) {
  const distPath = clientDistPath || getClientDistPath();
  const isDev = process.env.NODE_ENV === "development" || process.env.VITE_DEV === "true";
  if (isDev) {
    console.warn(
      "\u{1F527} Development mode: Proxying client requests to Vite dev server"
    );
    app.get("*", async (c) => {
      const path = c.req.path;
      if (path.startsWith("/api/") || path.startsWith("/inspector/api/") || path === "/inspector/config.json") {
        return c.notFound();
      }
      try {
        const viteUrl = `http://localhost:3000${path}`;
        const response = await fetch(viteUrl, {
          signal: AbortSignal.timeout(1e3)
          // 1 second timeout
        });
        if (response.ok) {
          const content = await response.text();
          const contentType = response.headers.get("content-type") || "text/html";
          c.header("Content-Type", contentType);
          return c.html(content);
        }
      } catch (error) {
        console.warn(`Failed to proxy to Vite dev server: ${error}`);
      }
      return c.html(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>MCP Inspector - Development</title>
          </head>
          <body>
            <h1>MCP Inspector - Development Mode</h1>
            <p>Vite dev server is not running. Please start it with:</p>
            <pre>yarn dev:client</pre>
            </body>
        </html>
      `);
    });
  } else {
    registerStaticRoutes(app, distPath);
  }
}

export {
  registerStaticRoutes,
  registerStaticRoutesWithDevProxy
};
