import{N as Be,O as Ue,P as J,Q as te,i as Ce,S as H,y as ue,g as U,U as At,V as Ot,W as Nt,X as kt,Y as xt,Z as Pt,$ as Mt,a0 as Rt,a1 as Dt,a2 as Lt,h as Ft,a3 as Bt,a4 as Ut,a5 as jt,b as Vt,a6 as zt,a7 as Gt,a8 as Zt,a9 as $t,aa as Ht,r as Wt,ab as Jt,a as Ge,ac as Xt,ad as Ze,ae as Yt,af as Kt,ag as qt,ah as Se,ai as Qt,aj as ea,ak as ta,q as $e,al as ne,e as ie,am as He,an as We,x as oe,L as aa,C as be,ao as je,w as sa,R as Ve,z as X,t as na,ap as Ie,E as ra,M as Je,aq as ia,ar as oa,as as ca,B as Xe,at as re,k as G,au as Ye,av as ua,aw as Ke,ax as la,l as ha,m as pa,ay as ga,az as ma,aA as fa,aB as da,aC as ba,aD as _a,aE as ya,aF as Ta,D as ze,aG as va,G as Ea,aH as wa,aI as Ca,aJ as Te,o as qe,s as Qe,u as Sa}from"./index-Dnlk3cN0.js";import{c as Ia}from"./index-CTPvdefa.js";import{r as Aa}from"./index-DRz5BQNA.js";function et(e,a,n,r,i){if(a!==e){typeof a.toJSON=="function"&&(a=a.toJSON());for(var c=Be(a),h=Be(e),l=!1,m=h.length-1;m>=0;m--){var g=h[m],T=e[g];if(Ue(a,g)&&!(a[g]===void 0&&T!==void 0&&Array.isArray(a)===!1)){var _=a[g];typeof T=="object"&&T!=null&&typeof _=="object"&&_!=null&&Array.isArray(T)===Array.isArray(_)?et(T,_,n,r+"/"+J(g),i):T!==_&&(i&&n.push({op:"test",path:r+"/"+J(g),value:te(T)}),n.push({op:"replace",path:r+"/"+J(g),value:te(_)}))}else Array.isArray(e)===Array.isArray(a)?(i&&n.push({op:"test",path:r+"/"+J(g),value:te(T)}),n.push({op:"remove",path:r+"/"+J(g)}),l=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:a}))}if(!(!l&&c.length==h.length))for(var m=0;m<c.length;m++){var g=c[m];!Ue(e,g)&&a[g]!==void 0&&n.push({op:"add",path:r+"/"+J(g),value:te(a[g])})}}}function Ae(e,a,n=!1){var r=[];return et(e,a,r,"",n),r}function tt(e){return e!==void 0&&Array.isArray(e.lc_namespace)}function at(e){return e!==void 0&&H.isRunnable(e)&&"lc_name"in e.constructor&&typeof e.constructor.lc_name=="function"&&e.constructor.lc_name()==="RunnableToolLike"}function st(e){return!!e&&typeof e=="object"&&"name"in e&&"schema"in e&&(Ce(e.schema)||e.schema!=null&&typeof e.schema=="object"&&"type"in e.schema&&typeof e.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(e.schema.type))}function nt(e){return st(e)||at(e)||tt(e)}var Oa={};U(Oa,{convertToOpenAIFunction:()=>rt,convertToOpenAITool:()=>Na,isLangChainTool:()=>nt,isRunnableToolLike:()=>at,isStructuredTool:()=>tt,isStructuredToolParams:()=>st});function rt(e,a){const n=typeof a=="number"?void 0:a;return{name:e.name,description:e.description,parameters:ue(e.schema),...n?.strict!==void 0?{strict:n.strict}:{}}}function Na(e,a){const n=typeof a=="number"?void 0:a;let r;return nt(e)?r={type:"function",function:rt(e)}:r=e,n?.strict!==void 0&&(r.function.strict=n.strict),r}var ka={};U(ka,{extendInteropZodObject:()=>qt,getInteropZodDefaultGetter:()=>Kt,getInteropZodObjectShape:()=>Yt,getSchemaDescription:()=>Ze,interopParse:()=>Xt,interopParseAsync:()=>Ge,interopSafeParse:()=>Jt,interopSafeParseAsync:()=>Wt,interopZodObjectMakeFieldsOptional:()=>Ht,interopZodObjectPartial:()=>$t,interopZodObjectPassthrough:()=>Zt,interopZodObjectStrict:()=>Gt,interopZodTransformInputSchema:()=>zt,isInteropZodError:()=>Vt,isInteropZodLiteral:()=>jt,isInteropZodObject:()=>Ut,isInteropZodSchema:()=>Ce,isShapelessZodSchema:()=>Bt,isSimpleStringZodSchema:()=>Ft,isZodArrayV4:()=>Lt,isZodLiteralV3:()=>Dt,isZodLiteralV4:()=>Rt,isZodNullableV4:()=>Mt,isZodObjectV3:()=>Pt,isZodObjectV4:()=>xt,isZodOptionalV4:()=>kt,isZodSchema:()=>Nt,isZodSchemaV3:()=>Ot,isZodSchemaV4:()=>At});var xa={};U(xa,{BasePromptValue:()=>le,ChatPromptValue:()=>ot,ImagePromptValue:()=>Pa,StringPromptValue:()=>it});var le=class extends ea{},it=class extends le{static lc_name(){return"StringPromptValue"}lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;value;constructor(e){super({value:e}),this.value=e}toString(){return this.value}toChatMessages(){return[new Se(this.value)]}},ot=class extends le{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ChatPromptValue"}messages;constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),this.messages=e.messages}toString(){return Qt(this.messages)}toChatMessages(){return this.messages}},Pa=class extends le{lc_namespace=["langchain_core","prompt_values"];lc_serializable=!0;static lc_name(){return"ImagePromptValue"}imageUrl;value;constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Se({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},b="0123456789abcdef".split(""),Ma=[-2147483648,8388608,32768,128],F=[24,16,8,0],ae=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],k=[];function B(e,a){a?(k[0]=k[16]=k[1]=k[2]=k[3]=k[4]=k[5]=k[6]=k[7]=k[8]=k[9]=k[10]=k[11]=k[12]=k[13]=k[14]=k[15]=0,this.blocks=k):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}B.prototype.update=function(e){if(!this.finalized){var a,n=typeof e;if(n!=="string"){if(n==="object"){if(e===null)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw new Error(ERROR)}else throw new Error(ERROR);a=!0}for(var r,i=0,c,h=e.length,l=this.blocks;i<h;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,this.block=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),a)for(c=this.start;i<h&&c<64;++i)l[c>>>2]|=e[i]<<F[c++&3];else for(c=this.start;i<h&&c<64;++i)r=e.charCodeAt(i),r<128?l[c>>>2]|=r<<F[c++&3]:r<2048?(l[c>>>2]|=(192|r>>>6)<<F[c++&3],l[c>>>2]|=(128|r&63)<<F[c++&3]):r<55296||r>=57344?(l[c>>>2]|=(224|r>>>12)<<F[c++&3],l[c>>>2]|=(128|r>>>6&63)<<F[c++&3],l[c>>>2]|=(128|r&63)<<F[c++&3]):(r=65536+((r&1023)<<10|e.charCodeAt(++i)&1023),l[c>>>2]|=(240|r>>>18)<<F[c++&3],l[c>>>2]|=(128|r>>>12&63)<<F[c++&3],l[c>>>2]|=(128|r>>>6&63)<<F[c++&3],l[c>>>2]|=(128|r&63)<<F[c++&3]);this.lastByteIndex=c,this.bytes+=c-this.start,c>=64?(this.block=l[16],this.start=c-64,this.hash(),this.hashed=!0):this.start=c}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};B.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,a=this.lastByteIndex;e[16]=this.block,e[a>>>2]|=Ma[a&3],this.block=e[16],a>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}};B.prototype.hash=function(){var e=this.h0,a=this.h1,n=this.h2,r=this.h3,i=this.h4,c=this.h5,h=this.h6,l=this.h7,m=this.blocks,g,T,_,v,d,y,f,E,w,P,I;for(g=16;g<64;++g)d=m[g-15],T=(d>>>7|d<<25)^(d>>>18|d<<14)^d>>>3,d=m[g-2],_=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,m[g]=m[g-16]+T+m[g-7]+_<<0;for(I=a&n,g=0;g<64;g+=4)this.first?(this.is224?(E=300032,d=m[0]-1413257819,l=d-150054599<<0,r=d+24177077<<0):(E=704751109,d=m[0]-210244248,l=d-1521486534<<0,r=d+143694565<<0),this.first=!1):(T=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),_=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),E=e&a,v=E^e&n^I,f=i&c^~i&h,d=l+_+f+ae[g]+m[g],y=T+v,l=r+d<<0,r=d+y<<0),T=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),_=(l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7),w=r&e,v=w^r&a^E,f=h&l^~h&i,d=c+_+f+ae[g+1]+m[g+1],y=T+v,h=n+d<<0,n=d+y<<0,T=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),_=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7),P=n&r,v=P^n&e^w,f=c&h^~c&l,d=i+_+f+ae[g+2]+m[g+2],y=T+v,c=a+d<<0,a=d+y<<0,T=(a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10),_=(c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7),I=a&n,v=I^a&r^P,f=c&h^~c&l,d=i+_+f+ae[g+3]+m[g+3],y=T+v,i=e+d<<0,e=d+y<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+e<<0,this.h1=this.h1+a<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0,this.h5=this.h5+c<<0,this.h6=this.h6+h<<0,this.h7=this.h7+l<<0};B.prototype.hex=function(){this.finalize();var e=this.h0,a=this.h1,n=this.h2,r=this.h3,i=this.h4,c=this.h5,h=this.h6,l=this.h7,m=b[e>>>28&15]+b[e>>>24&15]+b[e>>>20&15]+b[e>>>16&15]+b[e>>>12&15]+b[e>>>8&15]+b[e>>>4&15]+b[e&15]+b[a>>>28&15]+b[a>>>24&15]+b[a>>>20&15]+b[a>>>16&15]+b[a>>>12&15]+b[a>>>8&15]+b[a>>>4&15]+b[a&15]+b[n>>>28&15]+b[n>>>24&15]+b[n>>>20&15]+b[n>>>16&15]+b[n>>>12&15]+b[n>>>8&15]+b[n>>>4&15]+b[n&15]+b[r>>>28&15]+b[r>>>24&15]+b[r>>>20&15]+b[r>>>16&15]+b[r>>>12&15]+b[r>>>8&15]+b[r>>>4&15]+b[r&15]+b[i>>>28&15]+b[i>>>24&15]+b[i>>>20&15]+b[i>>>16&15]+b[i>>>12&15]+b[i>>>8&15]+b[i>>>4&15]+b[i&15]+b[c>>>28&15]+b[c>>>24&15]+b[c>>>20&15]+b[c>>>16&15]+b[c>>>12&15]+b[c>>>8&15]+b[c>>>4&15]+b[c&15]+b[h>>>28&15]+b[h>>>24&15]+b[h>>>20&15]+b[h>>>16&15]+b[h>>>12&15]+b[h>>>8&15]+b[h>>>4&15]+b[h&15];return this.is224||(m+=b[l>>>28&15]+b[l>>>24&15]+b[l>>>20&15]+b[l>>>16&15]+b[l>>>12&15]+b[l>>>8&15]+b[l>>>4&15]+b[l&15]),m};B.prototype.toString=B.prototype.hex;B.prototype.digest=function(){this.finalize();var e=this.h0,a=this.h1,n=this.h2,r=this.h3,i=this.h4,c=this.h5,h=this.h6,l=this.h7,m=[e>>>24&255,e>>>16&255,e>>>8&255,e&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255];return this.is224||m.push(l>>>24&255,l>>>16&255,l>>>8&255,l&255),m};B.prototype.array=B.prototype.digest;B.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),a=new DataView(e);return a.setUint32(0,this.h0),a.setUint32(4,this.h1),a.setUint32(8,this.h2),a.setUint32(12,this.h3),a.setUint32(16,this.h4),a.setUint32(20,this.h5),a.setUint32(24,this.h6),this.is224||a.setUint32(28,this.h7),e};const ct=(...e)=>new B(!1,!0).update(e.join("")).hex();var Ra={};U(Ra,{sha256:()=>ct});var Da={};U(Da,{BaseCache:()=>lt,InMemoryCache:()=>ht,defaultHashKeyEncoder:()=>ut,deserializeStoredGeneration:()=>La,serializeGeneration:()=>Fa});const ut=(...e)=>ct(e.join("_"));function La(e){return e.message!==void 0?{text:e.text,message:ta(e.message)}:{text:e.text}}function Fa(e){const a={text:e.text};return e.message!==void 0&&(a.message=e.message.toDict()),a}var lt=class{keyEncoder=ut;makeDefaultKeyEncoder(e){this.keyEncoder=e}};const Ba=new Map;var ht=class pt extends lt{cache;constructor(a){super(),this.cache=a??new Map}lookup(a,n){return Promise.resolve(this.cache.get(this.keyEncoder(a,n))??null)}async update(a,n,r){this.cache.set(this.keyEncoder(a,n),r)}static global(){return new pt(Ba)}},Ua=Aa();const ja=Ia(Ua);var Va=Object.defineProperty,za=(e,a,n)=>a in e?Va(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,Ga=(e,a,n)=>(za(e,a+"",n),n);function Za(e,a){let n=Array.from({length:e.length},(r,i)=>({start:i,end:i+1}));for(;n.length>1;){let r=null;for(let i=0;i<n.length-1;i++){const c=e.slice(n[i].start,n[i+1].end),h=a.get(c.join(","));h!=null&&(r==null||h<r[0])&&(r=[h,i])}if(r!=null){const i=r[1];n[i]={start:n[i].start,end:n[i+1].end},n.splice(i+1,1)}else break}return n}function $a(e,a){return e.length===1?[a.get(e.join(","))]:Za(e,a).map(n=>a.get(e.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function Ha(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var ve=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,a){this.patStr=e.pat_str;const n=e.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[c,h,...l]=i.split(" "),m=Number.parseInt(h,10);return l.forEach((g,T)=>r[g]=m+T),r},{});for(const[r,i]of Object.entries(n)){const c=ja.toByteArray(r);this.rankMap.set(c.join(","),i),this.textMap.set(i,c)}this.specialTokens={...e.special_tokens,...a},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,c])=>(r[c]=this.textEncoder.encode(i),r),{})}encode(e,a=[],n="all"){const r=new RegExp(this.patStr,"ug"),i=ve.specialTokenRegex(Object.keys(this.specialTokens)),c=[],h=new Set(a==="all"?Object.keys(this.specialTokens):a),l=new Set(n==="all"?Object.keys(this.specialTokens).filter(g=>!h.has(g)):n);if(l.size>0){const g=ve.specialTokenRegex([...l]),T=e.match(g);if(T!=null)throw new Error(`The text contains a special token that is not allowed: ${T[0]}`)}let m=0;for(;;){let g=null,T=m;for(;i.lastIndex=T,g=i.exec(e),!(g==null||h.has(g[0]));)T=g.index+1;const _=g?.index??e.length;for(const d of e.substring(m,_).matchAll(r)){const y=this.textEncoder.encode(d[0]),f=this.rankMap.get(y.join(","));if(f!=null){c.push(f);continue}c.push(...$a(y,this.rankMap))}if(g==null)break;let v=this.specialTokens[g[0]];c.push(v),m=g.index+g[0].length}return c}decode(e){const a=[];let n=0;for(let c=0;c<e.length;++c){const h=e[c],l=this.textMap.get(h)??this.inverseSpecialTokens[h];l!=null&&(a.push(l),n+=l.length)}const r=new Uint8Array(n);let i=0;for(const c of a)r.set(c,i),i+=c.length;return this.textDecoder.decode(r)}},gt=ve;Ga(gt,"specialTokenRegex",e=>new RegExp(e.map(a=>Ha(a)).join("|"),"g"));function Wa(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var Ja={};U(Ja,{encodingForModel:()=>Oe,getEncoding:()=>mt});const se={},Xa=new $e({});async function mt(e){return e in se||(se[e]=Xa.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(a=>a.json()).then(a=>new gt(a)).catch(a=>{throw delete se[e],a})),await se[e]}async function Oe(e){return mt(Wa(e))}var Ya={};U(Ya,{BaseLangChain:()=>dt,BaseLanguageModel:()=>bt,calculateMaxTokens:()=>Qa,getEmbeddingContextSize:()=>Ka,getModelContextSize:()=>ft,getModelNameForTiktoken:()=>he,isOpenAITool:()=>qa});const he=e=>e.startsWith("gpt-5")?"gpt-5":e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,Ka=e=>{switch(e){case"text-embedding-ada-002":return 8191;default:return 2046}},ft=e=>{switch(he(e)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function qa(e){return typeof e!="object"||!e?!1:!!("type"in e&&e.type==="function"&&"function"in e&&typeof e.function=="object"&&e.function&&"name"in e.function&&"parameters"in e.function)}const Qa=async({prompt:e,modelName:a})=>{let n;try{n=(await Oe(he(a))).encode(e).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),n=Math.ceil(e.length/4)}return ft(a)-n},es=()=>!1;var dt=class extends H{verbose;callbacks;tags;metadata;get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),this.verbose=e.verbose??es(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},bt=class extends dt{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}caller;cache;constructor({callbacks:e,callbackManager:a,...n}){const{cache:r,...i}=n;super({callbacks:e??a,...i}),typeof r=="object"?this.cache=r:r?this.cache=ht.global():this.cache=void 0,this.caller=new $e(n??{})}_encoding;async getNumTokens(e){let a;typeof e=="string"?a=e:a=e.map(r=>typeof r=="string"?r:r.type==="text"&&"text"in r?r.text:"").join("");let n=Math.ceil(a.length/4);if(!this._encoding)try{this._encoding=await Oe("modelName"in this?he(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(a).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new it(e):Array.isArray(e)?new ot(e.map(ne)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...a}){const n={...this._identifyingParams(),...a,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([c,h])=>h!==void 0).map(([c,h])=>`${c}:${JSON.stringify(h)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}},ce=class extends H{static lc_name(){return"RunnablePassthrough"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;func;constructor(e){super(e),e&&(this.func=e.func)}async invoke(e,a){const n=ie(a);return this.func&&await this.func(e,n),this._callWithConfig(r=>Promise.resolve(r),e,n)}async*transform(e,a){const n=ie(a);let r,i=!0;for await(const c of this._transformStreamWithConfig(e,h=>h,n))if(yield c,i)if(r===void 0)r=c;else try{r=oe(r,c)}catch{r=void 0,i=!1}this.func&&r!==void 0&&await this.func(r,n)}static assign(e){return new He(new We({steps:e}))}};const ts=e=>e();function _e(e){const a=e.constructor;return new a({...e,content:e.contentBlocks,response_metadata:{...e.response_metadata,output_version:"v1"}})}var as={};U(as,{BaseChatModel:()=>_t,SimpleChatModel:()=>ss});function ye(e){const a=[];for(const n of e){let r=n;if(Array.isArray(n.content))for(let i=0;i<n.content.length;i++){const c=n.content[i];(ia(c)||oa(c))&&r===n&&(r=new n.constructor({...r,content:[...n.content.slice(0,i),ca(c),...n.content.slice(i+1)]}))}a.push(r)}return a}var _t=class Z extends bt{lc_namespace=["langchain","chat_models",this._llmType()];disableStreaming=!1;outputVersion;get callKeys(){return[...super.callKeys,"outputVersion"]}constructor(a){super(a),this.outputVersion=ts(()=>{const n=a.outputVersion??aa("LC_OUTPUT_VERSION");return n&&["v0","v1"].includes(n)?n:"v0"})}_separateRunnableConfigFromCallOptionsCompat(a){const[n,r]=super._separateRunnableConfigFromCallOptions(a);return r.signal=n.signal,[n,r]}async invoke(a,n){const r=Z._convertInputToPromptValue(a);return(await this.generatePrompt([r],n,n?.callbacks)).generations[0][0].message}async*_streamResponseChunks(a,n,r){throw new Error("Not implemented.")}async*_streamIterator(a,n){if(this._streamResponseChunks===Z.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(a,n);else{const i=Z._convertInputToPromptValue(a).toChatMessages(),[c,h]=this._separateRunnableConfigFromCallOptionsCompat(n),l={...c.metadata,...this.getLsParams(h)},m=await be.configure(c.callbacks,this.callbacks,c.tags,this.tags,l,this.metadata,{verbose:this.verbose}),g={options:h,invocation_params:this?.invocationParams(h),batch_size:1},T=h.outputVersion??this.outputVersion,_=await m?.handleChatModelStart(this.toJSON(),[ye(i)],c.runId,void 0,g,void 0,void 0,c.runName);let v,d;try{for await(const y of this._streamResponseChunks(i,h,_?.[0])){if(y.message.id==null){const f=_?.at(0)?.runId;f!=null&&y.message._updateId(`run-${f}`)}y.message.response_metadata={...y.generationInfo,...y.message.response_metadata},T==="v1"?yield _e(y.message):yield y.message,v?v=v.concat(y):v=y,je(y.message)&&y.message.usage_metadata!==void 0&&(d={tokenUsage:{promptTokens:y.message.usage_metadata.input_tokens,completionTokens:y.message.usage_metadata.output_tokens,totalTokens:y.message.usage_metadata.total_tokens}})}}catch(y){throw await Promise.all((_??[]).map(f=>f?.handleLLMError(y))),y}await Promise.all((_??[]).map(y=>y?.handleLLMEnd({generations:[[v]],llmOutput:d})))}}getLsParams(a){const n=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:a.stop,ls_provider:n}}async _generateUncached(a,n,r,i){const c=a.map(v=>v.map(ne));let h;if(i!==void 0&&i.length===c.length)h=i;else{const v={...r.metadata,...this.getLsParams(n)},d=await be.configure(r.callbacks,this.callbacks,r.tags,this.tags,v,this.metadata,{verbose:this.verbose}),y={options:n,invocation_params:this?.invocationParams(n),batch_size:1};h=await d?.handleChatModelStart(this.toJSON(),c.map(ye),r.runId,void 0,y,void 0,void 0,r.runName)}const l=n.outputVersion??this.outputVersion,m=[],g=[];if(!!h?.[0].handlers.find(sa)&&!this.disableStreaming&&c.length===1&&this._streamResponseChunks!==Z.prototype._streamResponseChunks)try{const v=await this._streamResponseChunks(c[0],n,h?.[0]);let d,y;for await(const f of v){if(f.message.id==null){const E=h?.at(0)?.runId;E!=null&&f.message._updateId(`run-${E}`)}d===void 0?d=f:d=oe(d,f),je(f.message)&&f.message.usage_metadata!==void 0&&(y={tokenUsage:{promptTokens:f.message.usage_metadata.input_tokens,completionTokens:f.message.usage_metadata.output_tokens,totalTokens:f.message.usage_metadata.total_tokens}})}if(d===void 0)throw new Error("Received empty response from chat model call.");m.push([d]),await h?.[0].handleLLMEnd({generations:m,llmOutput:y})}catch(v){throw await h?.[0].handleLLMError(v),v}else{const v=await Promise.allSettled(c.map(async(d,y)=>{const f=await this._generate(d,{...n,promptIndex:y},h?.[y]);if(l==="v1")for(const E of f.generations)E.message=_e(E.message);return f}));await Promise.all(v.map(async(d,y)=>{if(d.status==="fulfilled"){const f=d.value;for(const E of f.generations){if(E.message.id==null){const w=h?.at(0)?.runId;w!=null&&E.message._updateId(`run-${w}`)}E.message.response_metadata={...E.generationInfo,...E.message.response_metadata}}return f.generations.length===1&&(f.generations[0].message.response_metadata={...f.llmOutput,...f.generations[0].message.response_metadata}),m[y]=f.generations,g[y]=f.llmOutput,h?.[y]?.handleLLMEnd({generations:[f.generations],llmOutput:f.llmOutput})}else return await h?.[y]?.handleLLMError(d.reason),Promise.reject(d.reason)}))}const _={generations:m,llmOutput:g.length?this._combineLLMOutput?.(...g):void 0};return Object.defineProperty(_,Ve,{value:h?{runIds:h?.map(v=>v.runId)}:void 0,configurable:!0}),_}async _generateCached({messages:a,cache:n,llmStringKey:r,parsedOptions:i,handledOptions:c}){const h=a.map(w=>w.map(ne)),l={...c.metadata,...this.getLsParams(i)},m=await be.configure(c.callbacks,this.callbacks,c.tags,this.tags,l,this.metadata,{verbose:this.verbose}),g={options:i,invocation_params:this?.invocationParams(i),batch_size:1},T=await m?.handleChatModelStart(this.toJSON(),h.map(ye),c.runId,void 0,g,void 0,void 0,c.runName),_=[],d=(await Promise.allSettled(h.map(async(w,P)=>{const I=Z._convertInputToPromptValue(w).toString(),R=await n.lookup(I,r);return R==null&&_.push(P),R}))).map((w,P)=>({result:w,runManager:T?.[P]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),y=i.outputVersion??this.outputVersion,f=[];await Promise.all(d.map(async({result:w,runManager:P},I)=>{if(w.status==="fulfilled"){const R=w.value;return f[I]=R.map(L=>("message"in L&&X(L.message)&&na(L.message)&&(L.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},y==="v1"&&(L.message=_e(L.message))),L.generationInfo={...L.generationInfo,tokenUsage:{}},L)),R.length&&await P?.handleLLMNewToken(R[0].text),P?.handleLLMEnd({generations:[R]},void 0,void 0,void 0,{cached:!0})}else return await P?.handleLLMError(w.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(w.reason)}));const E={generations:f,missingPromptIndices:_,startedRunManagers:T};return Object.defineProperty(E,Ve,{value:T?{runIds:T?.map(w=>w.runId)}:void 0,configurable:!0}),E}async generate(a,n,r){let i;Array.isArray(n)?i={stop:n}:i=n;const c=a.map(y=>y.map(ne)),[h,l]=this._separateRunnableConfigFromCallOptionsCompat(i);if(h.callbacks=h.callbacks??r,!this.cache)return this._generateUncached(c,l,h);const{cache:m}=this,g=this._getSerializedCacheKeyParametersForCall(l),{generations:T,missingPromptIndices:_,startedRunManagers:v}=await this._generateCached({messages:c,cache:m,llmStringKey:g,parsedOptions:l,handledOptions:h});let d={};if(_.length>0){const y=await this._generateUncached(_.map(f=>c[f]),l,h,v!==void 0?_.map(f=>v?.[f]):void 0);await Promise.all(y.generations.map(async(f,E)=>{const w=_[E];T[w]=f;const P=Z._convertInputToPromptValue(c[w]).toString();return m.update(P,g,f)})),d=y.llmOutput??{}}return{generations:T,llmOutput:d}}invocationParams(a){return{}}_modelType(){return"base_chat_model"}async generatePrompt(a,n,r){const i=a.map(c=>c.toChatMessages());return this.generate(i,n,r)}withStructuredOutput(a,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(n?.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=a,i=n?.name,c=Ze(r)??"A function available to call.",h=n?.method,l=n?.includeRaw;if(h==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let m=i??"extract",g;Ce(r)?g=[{type:"function",function:{name:m,description:c,parameters:ue(r)}}]:("name"in r&&(m=r.name),g=[{type:"function",function:{name:m,description:c,parameters:r}}]);const T=this.bindTools(g),_=Ie.from(f=>{if(!ra.isInstance(f))throw new Error("Input is not an AIMessageChunk.");if(!f.tool_calls||f.tool_calls.length===0)throw new Error("No tool calls found in the response.");const E=f.tool_calls.find(w=>w.name===m);if(!E)throw new Error(`No tool call found with name ${m}.`);return E.args});if(!l)return T.pipe(_).withConfig({runName:"StructuredOutput"});const v=ce.assign({parsed:(f,E)=>_.invoke(f.raw,E)}),d=ce.assign({parsed:()=>null}),y=v.withFallbacks({fallbacks:[d]});return Je.from([{raw:T},y]).withConfig({runName:"StructuredOutputRunnable"})}},ss=class extends _t{async _generate(e,a,n){const r=await this._call(e,a,n),i=new Xe(r);if(typeof i.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:i.content,message:i}]}}},ns=class extends H{static lc_name(){return"RouterRunnable"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;runnables;constructor(e){super(e),this.runnables=e.runnables}async invoke(e,a){const{key:n,input:r}=e,i=this.runnables[n];if(i===void 0)throw new Error(`No runnable associated with key "${n}".`);return i.invoke(r,ie(a))}async batch(e,a,n){const r=e.map(_=>_.key),i=e.map(_=>_.input);if(r.find(_=>this.runnables[_]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const h=r.map(_=>this.runnables[_]),l=this._getOptionsList(a??{},e.length),m=l[0]?.maxConcurrency??n?.maxConcurrency,g=m&&m>0?m:e.length,T=[];for(let _=0;_<i.length;_+=g){const v=i.slice(_,_+g).map((y,f)=>h[f].invoke(y,l[f])),d=await Promise.all(v);T.push(d)}return T.flat()}async stream(e,a){const{key:n,input:r}=e,i=this.runnables[n];if(i===void 0)throw new Error(`No runnable associated with key "${n}".`);return i.stream(r,a)}},rs=class extends H{static lc_name(){return"RunnableBranch"}lc_namespace=["langchain_core","runnables"];lc_serializable=!0;default;branches;constructor(e){super(e),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const n=e.slice(0,-1).map(([i,c])=>[re(i),re(c)]),r=re(e[e.length-1]);return new this({branches:n,default:r})}async _invoke(e,a,n){let r;for(let i=0;i<this.branches.length;i+=1){const[c,h]=this.branches[i];if(await c.invoke(e,G(a,{callbacks:n?.getChild(`condition:${i+1}`)}))){r=await h.invoke(e,G(a,{callbacks:n?.getChild(`branch:${i+1}`)}));break}}return r||(r=await this.default.invoke(e,G(a,{callbacks:n?.getChild("branch:default")}))),r}async invoke(e,a={}){return this._callWithConfig(this._invoke,e,a)}async*_streamIterator(e,a){const r=await(await Ye(a))?.handleChainStart(this.toJSON(),ua(e,"input"),a?.runId,void 0,void 0,void 0,a?.runName);let i,c=!0,h;try{for(let l=0;l<this.branches.length;l+=1){const[m,g]=this.branches[l];if(await m.invoke(e,G(a,{callbacks:r?.getChild(`condition:${l+1}`)}))){h=await g.stream(e,G(a,{callbacks:r?.getChild(`branch:${l+1}`)}));for await(const _ of h)if(yield _,c)if(i===void 0)i=_;else try{i=oe(i,_)}catch{i=void 0,c=!1}break}}if(h===void 0){h=await this.default.stream(e,G(a,{callbacks:r?.getChild("branch:default")}));for await(const l of h)if(yield l,c)if(i===void 0)i=l;else try{i=oe(i,l)}catch{i=void 0,c=!1}}}catch(l){throw await r?.handleChainError(l),l}await r?.handleChainEnd(i??{})}},is=class extends Ke{runnable;inputMessagesKey;outputMessagesKey;historyMessagesKey;getMessageHistory;constructor(e){let a=Ie.from((c,h)=>this._enterHistory(c,h??{})).withConfig({runName:"loadHistory"});const n=e.historyMessagesKey??e.inputMessagesKey;n&&(a=ce.assign({[n]:a}).withConfig({runName:"insertHistory"}));const r=a.pipe(e.runnable.withListeners({onEnd:(c,h)=>this._exitHistory(c,h??{})})).withConfig({runName:"RunnableWithMessageHistory"}),i=e.config??{};super({...e,config:i,bound:r}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let a;if(typeof e=="object"&&!Array.isArray(e)&&!X(e)){let n;this.inputMessagesKey?n=this.inputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="input",Array.isArray(e[n])&&Array.isArray(e[n][0])?a=e[n][0]:a=e[n]}else a=e;if(typeof a=="string")return[new Se(a)];if(Array.isArray(a))return a;if(X(a))return[a];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(a,null,2)}`)}_getOutputMessages(e){let a;if(!Array.isArray(e)&&!X(e)&&typeof e!="string"){let n;this.outputMessagesKey!==void 0?n=this.outputMessagesKey:Object.keys(e).length===1?n=Object.keys(e)[0]:n="output",e.generations!==void 0?a=e.generations[0][0].message:a=e[n]}else a=e;if(typeof a=="string")return[new Xe(a)];if(Array.isArray(a))return a;if(X(a))return[a];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(a,null,2)}`)}async _enterHistory(e,a){const r=await(a?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?r.concat(this._getInputMessages(e)):r}async _exitHistory(e,a){const n=a.configurable?.messageHistory;let r;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?r=e.inputs[0]:r=e.inputs;let i=this._getInputMessages(r);if(this.historyMessagesKey===void 0){const l=await n.getMessages();i=i.slice(l.length)}const c=e.outputs;if(!c)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const h=this._getOutputMessages(c);await n.addMessages([...i,...h])}async _mergeConfig(...e){const a=await super._mergeConfig(...e);if(!a.configurable||!a.configurable.sessionId){const r={[this.inputMessagesKey??"input"]:"foo"},i={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(r)}, ${JSON.stringify(i)})`)}const{sessionId:n}=a.configurable;return a.configurable.messageHistory=await this.getMessageHistory(n),a}},os={};U(os,{RouterRunnable:()=>ns,Runnable:()=>H,RunnableAssign:()=>He,RunnableBinding:()=>Ke,RunnableBranch:()=>rs,RunnableEach:()=>_a,RunnableLambda:()=>Ie,RunnableMap:()=>We,RunnableParallel:()=>ba,RunnablePassthrough:()=>ce,RunnablePick:()=>da,RunnableRetry:()=>fa,RunnableSequence:()=>Je,RunnableToolLike:()=>ma,RunnableWithFallbacks:()=>ga,RunnableWithMessageHistory:()=>is,_coerceToRunnable:()=>re,ensureConfig:()=>ie,getCallbackManagerForConfig:()=>Ye,mergeConfigs:()=>pa,patchConfig:()=>G,pickRunnableConfigKeys:()=>ha,raceWithSignal:()=>la});var yt=class extends H{parseResultWithPrompt(e,a,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,a){return typeof e=="string"?this._callWithConfig(async(n,r)=>this.parseResult([{text:n}],r?.callbacks),e,{...a,runType:"parser"}):this._callWithConfig(async(n,r)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],r?.callbacks),e,{...a,runType:"parser"})}},pe=class extends yt{parseResult(e,a){return this.parse(e[0].text,a)}async parseWithPrompt(e,a,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},$=class extends Error{llmOutput;observation;sendToLLM;constructor(e,a,n,r=!1){if(super(e),this.llmOutput=a,this.observation=n,this.sendToLLM=r,r&&(n===void 0||a===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");ya(this,"OUTPUT_PARSING_FAILURE")}},q=class extends pe{async*_transform(e){for await(const a of e)typeof a=="string"?yield this.parseResult([{text:a}]):yield this.parseResult([{message:a,text:this._baseMessageToString(a)}])}async*transform(e,a){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...a,runType:"parser"})}},Ne=class extends q{diff=!1;constructor(e){super(e),this.diff=e?.diff??this.diff}async*_transform(e){let a,n;for await(const r of e){if(typeof r!="string"&&typeof r.content!="string")throw new Error("Cannot handle non-string output.");let i;if(Ta(r)){if(typeof r.content!="string")throw new Error("Cannot handle non-string message output.");i=new ze({message:r,text:r.content})}else if(X(r)){if(typeof r.content!="string")throw new Error("Cannot handle non-string message output.");i=new ze({message:va(r),text:r.content})}else i=new Ea({text:r});n===void 0?n=i:n=n.concat(i);const c=await this.parsePartialResult([n]);c!=null&&!wa(c,a)&&(this.diff?yield this._diff(a,c):yield c,a=c)}}getFormatInstructions(){return""}},cs={};U(cs,{applyPatch:()=>Ca,compare:()=>Ae});var us=class extends Ne{static lc_name(){return"JsonOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_concatOutputChunks(e,a){return this.diff?super._concatOutputChunks(e,a):a}_diff(e,a){if(a)return e?Ae(e,a):[{op:"replace",path:"",value:a}]}async parsePartialResult(e){return Te(e[0].text)}async parse(e){return Te(e,JSON.parse)}getFormatInstructions(){return""}},ls=class extends q{static lc_name(){return"BytesOutputParser"}lc_namespace=["langchain_core","output_parsers","bytes"];lc_serializable=!0;textEncoder=new TextEncoder;parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},Q=class extends q{re;async*_transform(e){let a="";for await(const n of e)if(typeof n=="string"?a+=n:a+=n.content,this.re){const r=[...a.matchAll(this.re)];if(r.length>1){let i=0;for(const c of r.slice(0,-1))yield[c[1]],i+=(c.index??0)+c[0].length;a=a.slice(i)}}else{const r=await this.parse(a);if(r.length>1){for(const i of r.slice(0,-1))yield[i];a=r[r.length-1]}}for(const n of await this.parse(a))yield[n]}},hs=class extends Q{static lc_name(){return"CommaSeparatedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;async parse(e){try{return e.trim().split(",").map(a=>a.trim())}catch{throw new $(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},ps=class extends Q{lc_namespace=["langchain_core","output_parsers","list"];length;separator;constructor({length:e,separator:a}){super(...arguments),this.length=e,this.separator=a||","}async parse(e){try{const a=e.trim().split(this.separator).map(n=>n.trim());if(this.length!==void 0&&a.length!==this.length)throw new $(`Incorrect number of items. Expected ${this.length}, got ${a.length}.`);return a}catch(a){throw Object.getPrototypeOf(a)===$.prototype?a:new $(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},gs=class extends Q{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/\d+\.\s([^\n]+)/g;async parse(e){return[...e.matchAll(this.re)??[]].map(a=>a[1])}},ms=class extends Q{static lc_name(){return"NumberedListOutputParser"}lc_namespace=["langchain_core","output_parsers","list"];lc_serializable=!0;getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}re=/^\s*[-*]\s([^\n]+)$/gm;async parse(e){return[...e.matchAll(this.re)??[]].map(a=>a[1])}},fs=class extends q{static lc_name(){return"StrOutputParser"}lc_namespace=["langchain_core","output_parsers","string"];lc_serializable=!0;parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((a,n)=>a+this._messageContentToString(n),"")}},Tt=class extends pe{static lc_name(){return"StructuredOutputParser"}lc_namespace=["langchain","output_parsers","structured"];toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),this.schema=e}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const a=qe(Object.fromEntries(Object.entries(e).map(([n,r])=>[n,Qe().describe(r)])));return new this(a)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(ue(this.schema))}
\`\`\`
`}async parse(e){try{const a=e.trim(),r=(a.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||a.match(/```json\s*([\s\S]*?)```/)?.[1]||a).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,c)=>`"${c.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await Ge(this.schema,JSON.parse(r))}catch(a){throw new $(`Failed to parse. Text: "${e}". Error: ${a}`,e)}}},vt=class extends Tt{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const a=e?.interpolationDepth??1;if(a<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(ue(this.schema)).replaceAll("{","{".repeat(a)).replaceAll("}","}".repeat(a))}
\`\`\``}_schemaToInstruction(e,a=2){const n=e;if("type"in n){let r=!1,i;if(Array.isArray(n.type)){const l=n.type.findIndex(m=>m==="null");l!==-1&&(r=!0,n.type.splice(l,1)),i=n.type.join(" | ")}else i=n.type;if(n.type==="object"&&n.properties){const l=n.description?` // ${n.description}`:"";return`{
${Object.entries(n.properties).map(([g,T])=>{const _=n.required?.includes(g)?"":" (optional)";return`${" ".repeat(a)}"${g}": ${this._schemaToInstruction(T,a+2)}${_}`}).join(`
`)}
${" ".repeat(a-2)}}${l}`}if(n.type==="array"&&n.items){const l=n.description?` // ${n.description}`:"";return`array[
${" ".repeat(a)}${this._schemaToInstruction(n.items,a+2)}
${" ".repeat(a-2)}] ${l}`}const c=r?" (nullable)":"",h=n.description?` // ${n.description}`:"";return`${i}${h}${c}`}if("anyOf"in n)return n.anyOf.map(r=>this._schemaToInstruction(r,a)).join(`
${" ".repeat(a-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const a=qe(Object.fromEntries(Object.entries(e).map(([n,r])=>[n,Qe().describe(r)])));return new this(a)}},ds=class extends pe{structuredInputParser;constructor({inputSchema:e}){super(...arguments),this.structuredInputParser=new vt(e)}async parse(e){let a;try{a=await this.structuredInputParser.parse(e)}catch(n){throw new $(`Failed to parse. Text: "${e}". Error: ${n}`,e)}return this.outputProcessor(a)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}};const bs=function(){const e={};e.parser=function(s,t){return new n(s,t)},e.SAXParser=n,e.SAXStream=g,e.createStream=m,e.MAX_BUFFER_LENGTH=64*1024;const a=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(s,t){if(!(this instanceof n))return new n(s,t);var p=this;i(p),p.q=p.c="",p.bufferCheckPosition=e.MAX_BUFFER_LENGTH,p.opt=t||{},p.opt.lowercase=p.opt.lowercase||p.opt.lowercasetags,p.looseCase=p.opt.lowercase?"toLowerCase":"toUpperCase",p.tags=[],p.closed=p.closedRoot=p.sawRoot=!1,p.tag=p.error=null,p.strict=!!s,p.noscript=!!(s||p.opt.noscript),p.state=u.BEGIN,p.strictEntities=p.opt.strictEntities,p.ENTITIES=p.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),p.attribList=[],p.opt.xmlns&&(p.ns=Object.create(y)),p.trackPosition=p.opt.position!==!1,p.trackPosition&&(p.position=p.line=p.column=0),Y(p,"onready")}Object.create||(Object.create=function(s){function t(){}t.prototype=s;var p=new t;return p}),Object.keys||(Object.keys=function(s){var t=[];for(var p in s)s.hasOwnProperty(p)&&t.push(p);return t});function r(s){for(var t=Math.max(e.MAX_BUFFER_LENGTH,10),p=0,o=0,C=a.length;o<C;o++){var O=s[a[o]].length;if(O>t)switch(a[o]){case"textNode":K(s);break;case"cdata":A(s,"oncdata",s.cdata),s.cdata="";break;case"script":A(s,"onscript",s.script),s.script="";break;default:ee(s,"Max buffer length exceeded: "+a[o])}p=Math.max(p,O)}var N=e.MAX_BUFFER_LENGTH-p;s.bufferCheckPosition=N+s.position}function i(s){for(var t=0,p=a.length;t<p;t++)s[a[t]]=""}function c(s){K(s),s.cdata!==""&&(A(s,"oncdata",s.cdata),s.cdata=""),s.script!==""&&(A(s,"onscript",s.script),s.script="")}n.prototype={end:function(){Pe(this)},write:St,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){c(this)}};var h=ReadableStream;h||(h=function(){});var l=e.EVENTS.filter(function(s){return s!=="error"&&s!=="end"});function m(s,t){return new g(s,t)}function g(s,t){if(!(this instanceof g))return new g(s,t);h.apply(this),this._parser=new n(s,t),this.writable=!0,this.readable=!0;var p=this;this._parser.onend=function(){p.emit("end")},this._parser.onerror=function(o){p.emit("error",o),p._parser.error=null},this._decoder=null,l.forEach(function(o){Object.defineProperty(p,"on"+o,{get:function(){return p._parser["on"+o]},set:function(C){if(!C)return p.removeAllListeners(o),p._parser["on"+o]=C,C;p.on(o,C)},enumerable:!0,configurable:!1})})}g.prototype=Object.create(h.prototype,{constructor:{value:g}}),g.prototype.write=function(s){return this._parser.write(s.toString()),this.emit("data",s),!0},g.prototype.end=function(s){return s&&s.length&&this.write(s),this._parser.end(),!0},g.prototype.on=function(s,t){var p=this;return!p._parser["on"+s]&&l.indexOf(s)!==-1&&(p._parser["on"+s]=function(){var o=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);o.splice(0,0,s),p.emit.apply(p,o)}),h.prototype.on.call(p,s,t)};var T="[CDATA[",_="DOCTYPE",v="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/2000/xmlns/",y={xml:v,xmlns:d},f=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,E=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,w=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,P=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function I(s){return s===" "||s===`
`||s==="\r"||s==="	"}function R(s){return s==='"'||s==="'"}function L(s){return s===">"||I(s)}function j(s,t){return s.test(t)}function wt(s,t){return!j(s,t)}var u=0;e.STATE={BEGIN:u++,BEGIN_WHITESPACE:u++,TEXT:u++,TEXT_ENTITY:u++,OPEN_WAKA:u++,SGML_DECL:u++,SGML_DECL_QUOTED:u++,DOCTYPE:u++,DOCTYPE_QUOTED:u++,DOCTYPE_DTD:u++,DOCTYPE_DTD_QUOTED:u++,COMMENT_STARTING:u++,COMMENT:u++,COMMENT_ENDING:u++,COMMENT_ENDED:u++,CDATA:u++,CDATA_ENDING:u++,CDATA_ENDING_2:u++,PROC_INST:u++,PROC_INST_BODY:u++,PROC_INST_ENDING:u++,OPEN_TAG:u++,OPEN_TAG_SLASH:u++,ATTRIB:u++,ATTRIB_NAME:u++,ATTRIB_NAME_SAW_WHITE:u++,ATTRIB_VALUE:u++,ATTRIB_VALUE_QUOTED:u++,ATTRIB_VALUE_CLOSED:u++,ATTRIB_VALUE_UNQUOTED:u++,ATTRIB_VALUE_ENTITY_Q:u++,ATTRIB_VALUE_ENTITY_U:u++,CLOSE_TAG:u++,CLOSE_TAG_SAW_WHITE:u++,SCRIPT:u++,SCRIPT_ENDING:u++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(s){var t=e.ENTITIES[s],p=typeof t=="number"?String.fromCharCode(t):t;e.ENTITIES[s]=p});for(var ke in e.STATE)e.STATE[e.STATE[ke]]=ke;u=e.STATE;function Y(s,t,p){s[t]&&s[t](p)}function A(s,t,p){s.textNode&&K(s),Y(s,t,p)}function K(s){s.textNode=xe(s.opt,s.textNode),s.textNode&&Y(s,"ontext",s.textNode),s.textNode=""}function xe(s,t){return s.trim&&(t=t.trim()),s.normalize&&(t=t.replace(/\s+/g," ")),t}function ee(s,t){return K(s),s.trackPosition&&(t+=`
Line: `+s.line+`
Column: `+s.column+`
Char: `+s.c),t=new Error(t),s.error=t,Y(s,"onerror",t),s}function Pe(s){return s.sawRoot&&!s.closedRoot&&S(s,"Unclosed root tag"),s.state!==u.BEGIN&&s.state!==u.BEGIN_WHITESPACE&&s.state!==u.TEXT&&ee(s,"Unexpected end"),K(s),s.c="",s.closed=!0,Y(s,"onend"),n.call(s,s.strict,s.opt),s}function S(s,t){if(typeof s!="object"||!(s instanceof n))throw new Error("bad call to strictFail");s.strict&&ee(s,t)}function Ct(s){s.strict||(s.tagName=s.tagName[s.looseCase]());var t=s.tags[s.tags.length-1]||s,p=s.tag={name:s.tagName,attributes:{}};s.opt.xmlns&&(p.ns=t.ns),s.attribList.length=0,A(s,"onopentagstart",p)}function ge(s,t){var p=s.indexOf(":"),o=p<0?["",s]:s.split(":"),C=o[0],O=o[1];return t&&s==="xmlns"&&(C="xmlns",O=""),{prefix:C,local:O}}function me(s){if(s.strict||(s.attribName=s.attribName[s.looseCase]()),s.attribList.indexOf(s.attribName)!==-1||s.tag.attributes.hasOwnProperty(s.attribName)){s.attribName=s.attribValue="";return}if(s.opt.xmlns){var t=ge(s.attribName,!0),p=t.prefix,o=t.local;if(p==="xmlns")if(o==="xml"&&s.attribValue!==v)S(s,"xml: prefix must be bound to "+v+`
Actual: `+s.attribValue);else if(o==="xmlns"&&s.attribValue!==d)S(s,"xmlns: prefix must be bound to "+d+`
Actual: `+s.attribValue);else{var C=s.tag,O=s.tags[s.tags.length-1]||s;C.ns===O.ns&&(C.ns=Object.create(O.ns)),C.ns[o]=s.attribValue}s.attribList.push([s.attribName,s.attribValue])}else s.tag.attributes[s.attribName]=s.attribValue,A(s,"onattribute",{name:s.attribName,value:s.attribValue});s.attribName=s.attribValue=""}function z(s,t){if(s.opt.xmlns){var p=s.tag,o=ge(s.tagName);p.prefix=o.prefix,p.local=o.local,p.uri=p.ns[o.prefix]||"",p.prefix&&!p.uri&&(S(s,"Unbound namespace prefix: "+JSON.stringify(s.tagName)),p.uri=o.prefix);var C=s.tags[s.tags.length-1]||s;p.ns&&C.ns!==p.ns&&Object.keys(p.ns).forEach(function(Fe){A(s,"onopennamespace",{prefix:Fe,uri:p.ns[Fe]})});for(var O=0,N=s.attribList.length;O<N;O++){var M=s.attribList[O],D=M[0],W=M[1],x=ge(D,!0),V=x.prefix,It=x.local,Le=V===""?"":p.ns[V]||"",de={name:D,value:W,prefix:V,local:It,uri:Le};V&&V!=="xmlns"&&!Le&&(S(s,"Unbound namespace prefix: "+JSON.stringify(V)),de.uri=V),s.tag.attributes[D]=de,A(s,"onattribute",de)}s.attribList.length=0}s.tag.isSelfClosing=!!t,s.sawRoot=!0,s.tags.push(s.tag),A(s,"onopentag",s.tag),t||(!s.noscript&&s.tagName.toLowerCase()==="script"?s.state=u.SCRIPT:s.state=u.TEXT,s.tag=null,s.tagName=""),s.attribName=s.attribValue="",s.attribList.length=0}function fe(s){if(!s.tagName){S(s,"Weird empty close tag."),s.textNode+="</>",s.state=u.TEXT;return}if(s.script){if(s.tagName!=="script"){s.script+="</"+s.tagName+">",s.tagName="",s.state=u.SCRIPT;return}A(s,"onscript",s.script),s.script=""}var t=s.tags.length,p=s.tagName;s.strict||(p=p[s.looseCase]());for(var o=p;t--;){var C=s.tags[t];if(C.name!==o)S(s,"Unexpected close tag");else break}if(t<0){S(s,"Unmatched closing tag: "+s.tagName),s.textNode+="</"+s.tagName+">",s.state=u.TEXT;return}s.tagName=p;for(var O=s.tags.length;O-- >t;){var N=s.tag=s.tags.pop();s.tagName=s.tag.name,A(s,"onclosetag",s.tagName);var M={};for(var D in N.ns)M[D]=N.ns[D];var W=s.tags[s.tags.length-1]||s;s.opt.xmlns&&N.ns!==W.ns&&Object.keys(N.ns).forEach(function(x){var V=N.ns[x];A(s,"onclosenamespace",{prefix:x,uri:V})})}t===0&&(s.closedRoot=!0),s.tagName=s.attribValue=s.attribName="",s.attribList.length=0,s.state=u.TEXT}function Me(s){var t=s.entity,p=t.toLowerCase(),o,C="";return s.ENTITIES[t]?s.ENTITIES[t]:s.ENTITIES[p]?s.ENTITIES[p]:(t=p,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),o=parseInt(t,16),C=o.toString(16)):(t=t.slice(1),o=parseInt(t,10),C=o.toString(10))),t=t.replace(/^0+/,""),isNaN(o)||C.toLowerCase()!==t?(S(s,"Invalid character entity"),"&"+s.entity+";"):String.fromCodePoint(o))}function Re(s,t){t==="<"?(s.state=u.OPEN_WAKA,s.startTagPosition=s.position):I(t)||(S(s,"Non-whitespace before first tag."),s.textNode=t,s.state=u.TEXT)}function De(s,t){var p="";return t<s.length&&(p=s.charAt(t)),p}function St(s){var t=this;if(this.error)throw this.error;if(t.closed)return ee(t,"Cannot write after close. Assign an onready handler.");if(s===null)return Pe(t);typeof s=="object"&&(s=s.toString());for(var p=0,o="";o=De(s,p++),t.c=o,!!o;)switch(t.trackPosition&&(t.position++,o===`
`?(t.line++,t.column=0):t.column++),t.state){case u.BEGIN:if(t.state=u.BEGIN_WHITESPACE,o==="\uFEFF")continue;Re(t,o);continue;case u.BEGIN_WHITESPACE:Re(t,o);continue;case u.TEXT:if(t.sawRoot&&!t.closedRoot){for(var C=p-1;o&&o!=="<"&&o!=="&";)o=De(s,p++),o&&t.trackPosition&&(t.position++,o===`
`?(t.line++,t.column=0):t.column++);t.textNode+=s.substring(C,p-1)}o==="<"&&!(t.sawRoot&&t.closedRoot&&!t.strict)?(t.state=u.OPEN_WAKA,t.startTagPosition=t.position):(!I(o)&&(!t.sawRoot||t.closedRoot)&&S(t,"Text data outside of root node."),o==="&"?t.state=u.TEXT_ENTITY:t.textNode+=o);continue;case u.SCRIPT:o==="<"?t.state=u.SCRIPT_ENDING:t.script+=o;continue;case u.SCRIPT_ENDING:o==="/"?t.state=u.CLOSE_TAG:(t.script+="<"+o,t.state=u.SCRIPT);continue;case u.OPEN_WAKA:if(o==="!")t.state=u.SGML_DECL,t.sgmlDecl="";else if(!I(o))if(j(f,o))t.state=u.OPEN_TAG,t.tagName=o;else if(o==="/")t.state=u.CLOSE_TAG,t.tagName="";else if(o==="?")t.state=u.PROC_INST,t.procInstName=t.procInstBody="";else{if(S(t,"Unencoded <"),t.startTagPosition+1<t.position){var O=t.position-t.startTagPosition;o=new Array(O).join(" ")+o}t.textNode+="<"+o,t.state=u.TEXT}continue;case u.SGML_DECL:(t.sgmlDecl+o).toUpperCase()===T?(A(t,"onopencdata"),t.state=u.CDATA,t.sgmlDecl="",t.cdata=""):t.sgmlDecl+o==="--"?(t.state=u.COMMENT,t.comment="",t.sgmlDecl=""):(t.sgmlDecl+o).toUpperCase()===_?(t.state=u.DOCTYPE,(t.doctype||t.sawRoot)&&S(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):o===">"?(A(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=u.TEXT):(R(o)&&(t.state=u.SGML_DECL_QUOTED),t.sgmlDecl+=o);continue;case u.SGML_DECL_QUOTED:o===t.q&&(t.state=u.SGML_DECL,t.q=""),t.sgmlDecl+=o;continue;case u.DOCTYPE:o===">"?(t.state=u.TEXT,A(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=o,o==="["?t.state=u.DOCTYPE_DTD:R(o)&&(t.state=u.DOCTYPE_QUOTED,t.q=o));continue;case u.DOCTYPE_QUOTED:t.doctype+=o,o===t.q&&(t.q="",t.state=u.DOCTYPE);continue;case u.DOCTYPE_DTD:t.doctype+=o,o==="]"?t.state=u.DOCTYPE:R(o)&&(t.state=u.DOCTYPE_DTD_QUOTED,t.q=o);continue;case u.DOCTYPE_DTD_QUOTED:t.doctype+=o,o===t.q&&(t.state=u.DOCTYPE_DTD,t.q="");continue;case u.COMMENT:o==="-"?t.state=u.COMMENT_ENDING:t.comment+=o;continue;case u.COMMENT_ENDING:o==="-"?(t.state=u.COMMENT_ENDED,t.comment=xe(t.opt,t.comment),t.comment&&A(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+o,t.state=u.COMMENT);continue;case u.COMMENT_ENDED:o!==">"?(S(t,"Malformed comment"),t.comment+="--"+o,t.state=u.COMMENT):t.state=u.TEXT;continue;case u.CDATA:o==="]"?t.state=u.CDATA_ENDING:t.cdata+=o;continue;case u.CDATA_ENDING:o==="]"?t.state=u.CDATA_ENDING_2:(t.cdata+="]"+o,t.state=u.CDATA);continue;case u.CDATA_ENDING_2:o===">"?(t.cdata&&A(t,"oncdata",t.cdata),A(t,"onclosecdata"),t.cdata="",t.state=u.TEXT):o==="]"?t.cdata+="]":(t.cdata+="]]"+o,t.state=u.CDATA);continue;case u.PROC_INST:o==="?"?t.state=u.PROC_INST_ENDING:I(o)?t.state=u.PROC_INST_BODY:t.procInstName+=o;continue;case u.PROC_INST_BODY:if(!t.procInstBody&&I(o))continue;o==="?"?t.state=u.PROC_INST_ENDING:t.procInstBody+=o;continue;case u.PROC_INST_ENDING:o===">"?(A(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=u.TEXT):(t.procInstBody+="?"+o,t.state=u.PROC_INST_BODY);continue;case u.OPEN_TAG:j(E,o)?t.tagName+=o:(Ct(t),o===">"?z(t):o==="/"?t.state=u.OPEN_TAG_SLASH:(I(o)||S(t,"Invalid character in tag name"),t.state=u.ATTRIB));continue;case u.OPEN_TAG_SLASH:o===">"?(z(t,!0),fe(t)):(S(t,"Forward-slash in opening tag not followed by >"),t.state=u.ATTRIB);continue;case u.ATTRIB:if(I(o))continue;o===">"?z(t):o==="/"?t.state=u.OPEN_TAG_SLASH:j(f,o)?(t.attribName=o,t.attribValue="",t.state=u.ATTRIB_NAME):S(t,"Invalid attribute name");continue;case u.ATTRIB_NAME:o==="="?t.state=u.ATTRIB_VALUE:o===">"?(S(t,"Attribute without value"),t.attribValue=t.attribName,me(t),z(t)):I(o)?t.state=u.ATTRIB_NAME_SAW_WHITE:j(E,o)?t.attribName+=o:S(t,"Invalid attribute name");continue;case u.ATTRIB_NAME_SAW_WHITE:if(o==="=")t.state=u.ATTRIB_VALUE;else{if(I(o))continue;S(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",A(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",o===">"?z(t):j(f,o)?(t.attribName=o,t.state=u.ATTRIB_NAME):(S(t,"Invalid attribute name"),t.state=u.ATTRIB)}continue;case u.ATTRIB_VALUE:if(I(o))continue;R(o)?(t.q=o,t.state=u.ATTRIB_VALUE_QUOTED):(S(t,"Unquoted attribute value"),t.state=u.ATTRIB_VALUE_UNQUOTED,t.attribValue=o);continue;case u.ATTRIB_VALUE_QUOTED:if(o!==t.q){o==="&"?t.state=u.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=o;continue}me(t),t.q="",t.state=u.ATTRIB_VALUE_CLOSED;continue;case u.ATTRIB_VALUE_CLOSED:I(o)?t.state=u.ATTRIB:o===">"?z(t):o==="/"?t.state=u.OPEN_TAG_SLASH:j(f,o)?(S(t,"No whitespace between attributes"),t.attribName=o,t.attribValue="",t.state=u.ATTRIB_NAME):S(t,"Invalid attribute name");continue;case u.ATTRIB_VALUE_UNQUOTED:if(!L(o)){o==="&"?t.state=u.ATTRIB_VALUE_ENTITY_U:t.attribValue+=o;continue}me(t),o===">"?z(t):t.state=u.ATTRIB;continue;case u.CLOSE_TAG:if(t.tagName)o===">"?fe(t):j(E,o)?t.tagName+=o:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=u.SCRIPT):(I(o)||S(t,"Invalid tagname in closing tag"),t.state=u.CLOSE_TAG_SAW_WHITE);else{if(I(o))continue;wt(f,o)?t.script?(t.script+="</"+o,t.state=u.SCRIPT):S(t,"Invalid tagname in closing tag."):t.tagName=o}continue;case u.CLOSE_TAG_SAW_WHITE:if(I(o))continue;o===">"?fe(t):S(t,"Invalid characters in closing tag");continue;case u.TEXT_ENTITY:case u.ATTRIB_VALUE_ENTITY_Q:case u.ATTRIB_VALUE_ENTITY_U:var N,M;switch(t.state){case u.TEXT_ENTITY:N=u.TEXT,M="textNode";break;case u.ATTRIB_VALUE_ENTITY_Q:N=u.ATTRIB_VALUE_QUOTED,M="attribValue";break;case u.ATTRIB_VALUE_ENTITY_U:N=u.ATTRIB_VALUE_UNQUOTED,M="attribValue";break}if(o===";")if(t.opt.unparsedEntities){var D=Me(t);t.entity="",t.state=N,t.write(D)}else t[M]+=Me(t),t.entity="",t.state=N;else j(t.entity.length?P:w,o)?t.entity+=o:(S(t,"Invalid character in entity name"),t[M]+="&"+t.entity+o,t.entity="",t.state=N);continue;default:throw new Error(t,"Unknown state: "+t.state)}return t.position>=t.bufferCheckPosition&&r(t),t}return String.fromCodePoint||(function(){var s=String.fromCharCode,t=Math.floor,p=function(){var o=16384,C=[],O,N,M=-1,D=arguments.length;if(!D)return"";for(var W="";++M<D;){var x=Number(arguments[M]);if(!isFinite(x)||x<0||x>1114111||t(x)!==x)throw RangeError("Invalid code point: "+x);x<=65535?C.push(x):(x-=65536,O=(x>>10)+55296,N=x%1024+56320,C.push(O,N)),(M+1===D||C.length>o)&&(W+=s.apply(null,C),C.length=0)}return W};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:p,configurable:!0,writable:!0}):String.fromCodePoint=p})(),e},_s=bs(),Ee=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var ys=class extends Ne{tags;constructor(e){super(e),this.tags=e?.tags}static lc_name(){return"XMLOutputParser"}lc_namespace=["langchain_core","output_parsers"];lc_serializable=!0;_diff(e,a){if(a)return e?Ae(e,a):[{op:"replace",path:"",value:a}]}async parsePartialResult(e){return we(e[0].text)}async parse(e){return we(e)}getFormatInstructions(){return!!(this.tags&&this.tags.length>0)?Ee.replace("{tags}",this.tags?.join(", ")??""):Ee}};const Ts=e=>e.split(`
`).map(a=>a.replace(/^\s+/,"")).join(`
`).trim(),Et=e=>{if(Object.keys(e).length===0)return{};const a={};return e.children.length>0?(a[e.name]=e.children.map(Et),a):(a[e.name]=e.text??void 0,a)};function we(e){const a=Ts(e),n=_s.parser(!0);let r={};const i=[];n.onopentag=l=>{const m={name:l.name,attributes:l.attributes,children:[],text:"",isSelfClosing:l.isSelfClosing};i.length>0?i[i.length-1].children.push(m):r=m,l.isSelfClosing||i.push(m)},n.onclosetag=()=>{if(i.length>0){const l=i.pop();i.length===0&&l&&(r=l)}},n.ontext=l=>{if(i.length>0){const m=i[i.length-1];m.text+=l}},n.onattribute=l=>{if(i.length>0){const m=i[i.length-1];m.attributes[l.name]=l.value}};const c=/```(xml)?(.*)```/s.exec(a),h=c?c[2]:a;return n.write(h).close(),r&&r.name==="?xml"&&(r=r.children[0]),Et(r)}var vs={};U(vs,{AsymmetricStructuredOutputParser:()=>ds,BaseCumulativeTransformOutputParser:()=>Ne,BaseLLMOutputParser:()=>yt,BaseOutputParser:()=>pe,BaseTransformOutputParser:()=>q,BytesOutputParser:()=>ls,CommaSeparatedListOutputParser:()=>hs,CustomListOutputParser:()=>ps,JsonMarkdownStructuredOutputParser:()=>vt,JsonOutputParser:()=>us,ListOutputParser:()=>Q,MarkdownListOutputParser:()=>ms,NumberedListOutputParser:()=>gs,OutputParserException:()=>$,StringOutputParser:()=>fs,StructuredOutputParser:()=>Tt,XMLOutputParser:()=>ys,XML_FORMAT_INSTRUCTIONS:()=>Ee,parseJsonMarkdown:()=>Te,parsePartialJson:()=>Sa,parseXMLMarkdown:()=>we});export{dt as B,ot as C,Pa as I,us as J,$ as O,ce as R,Tt as S,tt as a,at as b,nt as c,Ne as d,bt as e,qa as f,yt as g,_t as h,st as i,Na as j,it as k,Ae as l,pe as m,Ja as n,cs as o,Ra as p,Oa as q,os as r,ct as s,ka as t,xa as u,vs as v,as as w,Ya as x,Da as y,ft as z};
