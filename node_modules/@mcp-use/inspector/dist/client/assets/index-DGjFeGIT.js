import{p as y,e as E,m as x,_ as g,i as P,a as $,b as N,T as f,v as O,C as A,c as I,d as L,f as S,g as J,o as F,s as R,h as M,j as B,k as b,A as C,l as _,n as j}from"./index-Dnlk3cN0.js";import{B as Z,i as W,a as H,b as K,c as V}from"./index-JNCLaBht.js";import{p as q}from"./index-CTPvdefa.js";var z={};J(z,{BaseToolkit:()=>G,DynamicStructuredTool:()=>k,DynamicTool:()=>D,StructuredTool:()=>T,Tool:()=>w,ToolInputParsingException:()=>f,isLangChainTool:()=>V,isRunnableToolLike:()=>K,isStructuredTool:()=>H,isStructuredToolParams:()=>W,tool:()=>Q});var T=class extends Z{extras;returnDirect=!1;verboseParsingErrors=!1;get lc_namespace(){return["langchain","tools"]}responseFormat="content";defaultConfig;constructor(t){super(t??{}),this.verboseParsingErrors=t?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=t?.responseFormat??this.responseFormat,this.defaultConfig=t?.defaultConfig??this.defaultConfig,this.metadata=t?.metadata??this.metadata,this.extras=t?.extras??this.extras}async invoke(t,e){let a,s=E(x(this.defaultConfig,e));return g(t)?(a=t.args,s={...s,toolCall:t}):a=t,this.call(a,s)}async call(t,e,a){const s=g(t)?t.args:t;let u;if(P(this.schema))try{u=await $(this.schema,s)}catch(c){let o="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(o=`${o}
Details: ${c.message}`),N(c)&&(o=`${o}

${q(c)}`),new f(o,JSON.stringify(t))}else{const c=O(s,this.schema);if(!c.valid){let o="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(o=`${o}
Details: ${c.errors.map(v=>`${v.keywordLocation}: ${v.error}`).join(`
`)}`),new f(o,JSON.stringify(t))}u=s}const n=y(e),h=await A.configure(n.callbacks,this.callbacks,n.tags||a,this.tags,n.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof t=="string"?t:JSON.stringify(t),n.runId,void 0,void 0,void 0,n.runName);delete n.runId;let r;try{r=await this._call(u,h,n)}catch(c){throw await h?.handleToolError(c),c}let m,p;if(this.responseFormat==="content_and_artifact")if(Array.isArray(r)&&r.length===2)[m,p]=r;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(r)}`);else m=r;let i;g(t)&&(i=t.id),!i&&I(n)&&(i=n.toolCall.id);const l=U({content:m,artifact:p,toolCallId:i,name:this.name,metadata:this.metadata});return await h?.handleToolEnd(l),l}},w=class extends T{schema=F({input:R().optional()}).transform(t=>t.input);constructor(t){super(t)}call(t,e){const a=typeof t=="string"||t==null?{input:t}:t;return super.call(a,e)}},D=class extends w{static lc_name(){return"DynamicTool"}name;description;func;constructor(t){super(t),this.name=t.name,this.description=t.description,this.func=t.func,this.returnDirect=t.returnDirect??this.returnDirect}async call(t,e){const a=y(e);return a.runName===void 0&&(a.runName=this.name),super.call(t,a)}async _call(t,e,a){return this.func(t,e,a)}},k=class extends T{static lc_name(){return"DynamicStructuredTool"}name;description;func;schema;constructor(t){super(t),this.name=t.name,this.description=t.description,this.func=t.func,this.returnDirect=t.returnDirect??this.returnDirect,this.schema=t.schema}async call(t,e,a){const s=y(e);return s.runName===void 0&&(s.runName=this.name),super.call(t,s,a)}_call(t,e,a){return this.func(t,e,a)}},G=class{getTools(){return this.tools}};function Q(t,e){const a=M(e.schema),s=B(e.schema);if(!e.schema||a||s)return new D({...e,description:e.description??e.schema?.description??`${e.name} tool`,func:async(d,h,r)=>new Promise((m,p)=>{const i=b(r,{callbacks:h?.getChild()});C.runWithConfig(_(i),async()=>{try{m(t(d,i))}catch(l){p(l)}})})});const u=e.schema,n=e.description??e.schema.description??`${e.name} tool`;return new k({...e,description:n,schema:u,func:async(d,h,r)=>new Promise((m,p)=>{let i;const l=()=>{r?.signal&&i&&r.signal.removeEventListener("abort",i)};r?.signal&&(i=()=>{l(),p(j(r.signal))},r.signal.addEventListener("abort",i));const c=b(r,{callbacks:h?.getChild()});C.runWithConfig(_(c),async()=>{try{const o=await t(d,c);if(r?.signal?.aborted){l();return}l(),m(o)}catch(o){l(),p(o)}})})})}function U(t){const{content:e,artifact:a,toolCallId:s,metadata:u}=t;return s&&!L(e)?typeof e=="string"||Array.isArray(e)&&e.every(n=>typeof n=="object")?new S({status:"success",content:e,artifact:a,tool_call_id:s,name:t.name,metadata:u}):new S({status:"success",content:X(e),artifact:a,tool_call_id:s,name:t.name,metadata:u}):e}function X(t){try{return JSON.stringify(t,null,2)??""}catch{return`${t}`}}export{k as D,T as S,w as T,Q as a,D as b,z as t};
